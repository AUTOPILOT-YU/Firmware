#!nsh
#
# PX4FMU startup script.

set logfile /fs/microsd/framlog.txt

#
# Try to mount the microSD card.
#
echo "[init] looking for microSD..."
if mount -t vfat /dev/mmcsd0 /fs/microsd
then
	echo "[init] card mounted at /fs/microsd"
	# Start playing the startup tune
	tone_alarm start
else
	echo "[init] no microSD card found"
	# Play SOS
	tone_alarm error
fi

#
# Start system state indicator
#
if rgbled start
then
	echo "Using external RGB Led"
else
	tone_alarm error
	echo "[FAIL] RGB led failed to start" >> $logfile
fi

# red, green, blue
# set blue
rgbled rgb 0 0 40

if mtd start
then
	echo "MTD started"
else
	tone_alarm error
	# red, green, blue
	# set red
	rgbled rgb 100 0 0
	echo "[FAIL] MTD driver failed to start" >> $logfile
fi

if tests mtd
then
	echo "MTD TEST SUCCEEDED"
	# red, green, blue
	# set green
	rgbled rgb 0 50 0
	echo "[OK] MTD write test succeeded" >> $logfile
else
	# red, green, blue
	# set red
	rgbled rgb 50 0 0
	echo "[FAIL] MTD write test failed" >> $logfile
fi

